<div class="page-container">
    <div class="page-header">
        <h1 class="glow-text">Approve Deposit Requests</h1>
        <div class="header-actions">
            <span class="admin-badge">ADMIN PANEL</span>
        </div>
    </div>

    <div class="history-table-3d">
        <div class="table-header">
            <div class="col">User Email</div>
            <div class="col">Amount</div>
            <div class="col">Method</div>
            <div class="col">Status</div>
            <div class="col">Date</div>
            <div class="col">Attachment</div>
            <div class="col actions">Actions</div>
        </div>

        <app-loader *ngIf="isLoading" message="Auditing global deposit requests..."></app-loader>

        @for (deposit of deposits; track deposit.id) {
        <div class="table-row admin-row">
            <div class="col user-info">
                <span class="user-email-only">{{ formatEmail(deposit.userName) }}</span>
            </div>
            <div class="col amount-stack">
                <span class="usd-amount">{{ deposit.amount | currency: (deposit.currency || 'USD') }}</span>
                <span
                    *ngIf="deposit.localAmount && (deposit.localAmount !== deposit.amount || deposit.localCurrency !== (deposit.currency || 'USD'))"
                    class="local-amount">
                    {{ deposit.localAmount | number:'1.0-2' }} {{ deposit.localCurrency }}
                </span>
            </div>
            <div class="col">{{ deposit.method }}</div>
            <div class="col">
                <span class="status-badge" [ngClass]="(deposit.status || 'pending').toLowerCase()">{{ deposit.status
                    }}</span>
            </div>
            <div class="col">{{ deposit.creationTime | date: 'MMM d, y h:mm a' }}</div>
            <div class="col proof-col">
                <button *ngIf="deposit.hasProof" class="btn-view-proof" (click)="viewProof(deposit)">
                    View
                </button>
                <span *ngIf="!deposit.hasProof" class="no-proof">No Proof</span>
            </div>
            <div class="col actions">
                <ng-container *ngIf="deposit.status === 'Pending'">
                    <button class="btn-approve" (click)="approve(deposit)">Approve</button>
                    <button class="btn-reject" (click)="reject(deposit)">Reject</button>
                </ng-container>
                <span *ngIf="deposit.status !== 'Pending'" class="processed-text">
                    {{ deposit.adminRemarks || 'Processed' }}
                </span>
            </div>
        </div>
        }

        @if (!isLoading && deposits.length === 0) {
        <div class="table-row">
            <div class="col" style="width: 100%; text-align: center;">No deposit requests found.</div>
        </div>
        }

        <!-- Pagination Section -->
        <div class="pagination-container" *ngIf="totalCount > 0 && !isLoading">
            <div class="pagination-info">
                Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalCount }} deposits
            </div>

            <div class="pagination-controls">
                <button class="btn-pagination" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>

                <div class="page-numbers">
                    <button *ngFor="let page of getPageNumbers()" class="page-btn" [class.active]="page === currentPage"
                        (click)="changePage(page)">
                        {{ page }}
                    </button>
                </div>

                <button class="btn-pagination" [disabled]="currentPage === totalPages"
                    (click)="changePage(currentPage + 1)">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>