<div class="page-container">
    <div class="header-card-3d">
        <div class="header-content">
            <h3>Withdraw Funds to your Account</h3>
            <div class="header-image">
                <span class="icon">üí∞</span>
            </div>
        </div>
    </div>

    <div class="form-card-3d" [class.loading-overlay]="isLoading">
        <form (ngSubmit)="submitWithdraw()">
            <!-- Source Card Selection -->
            <div class="form-group" *ngIf="userCards.length > 0">
                <label>Withdraw From Card <span class="required">*</span></label>
                <select [(ngModel)]="selectedSourceCardId" name="sourceCard" class="form-control"
                    [disabled]="isLoading">
                    <option *ngFor="let card of userCards" [value]="card.cardId">
                        {{ card.cardType }} - {{ card.cardNumber }} ({{ card.balance | currency }})
                    </option>
                </select>
            </div>
            <div class="info-box warning-card" *ngIf="userCards.length === 0 && !isLoading">
                <p>‚ö†Ô∏è You don't have any active cards with balance to withdraw from.</p>
            </div>

            <!-- Bank Account Details (Editable) -->
            <div class="bank-details-input-section">
                <div class="form-group">
                    <label>Bank Name <span class="required">*</span></label>
                    <input type="text" name="bankName" [(ngModel)]="bankDetails.bankName" class="form-control"
                        placeholder="e.g. JPMorgan Chase" required [disabled]="isLoading">
                </div>
                <div class="form-group">
                    <label>Account Title <span class="required">*</span></label>
                    <input type="text" name="accountTitle" [(ngModel)]="bankDetails.accountTitle" class="form-control"
                        placeholder="Account Holder Name" required [disabled]="isLoading">
                </div>
                <div class="form-group">
                    <label>Account Number <span class="required">*</span></label>
                    <input type="text" name="accountNumber" [(ngModel)]="bankDetails.accountNumber" class="form-control"
                        placeholder="Account Number" required [disabled]="isLoading">
                </div>
                <div class="form-group">
                    <label>IBAN (Optional)</label>
                    <input type="text" name="iban" [(ngModel)]="bankDetails.iban" class="form-control"
                        placeholder="IBAN if applicable" [disabled]="isLoading">
                </div>
            </div>

            <!-- Withdrawal Amount Input -->
            <div class="form-group">
                <label for="amount">Amount to Withdraw <span class="required">*</span></label>
                <div class="amount-input-group">
                    <span class="currency-symbol">$</span>
                    <input type="number" name="amount" id="amount" [(ngModel)]="amount" class="form-control"
                        placeholder="Enter amount" min="10" required [disabled]="isLoading || userCards.length === 0">
                    <span class="currency-code">USD</span>
                </div>
                <p class="help-text">Minimum withdrawal: $10.00</p>
                <p class="help-text" *ngIf="amount">Approx Receipt: Rs {{ calculateLocalAmount() | number }} PKR</p>
            </div>

            <!-- Submit Button -->
            <div class="form-group">
                <button type="submit" class="btn-3d btn-submit"
                    [disabled]="!amount || !bankDetails.bankName || !bankDetails.accountNumber || !selectedSourceCardId || isLoading">
                    <span *ngIf="!isLoading">Confirm Withdrawal</span>
                    <span *ngIf="isLoading">Processing...</span>
                </button>
            </div>
        </form>
    </div>
</div>