<header class="header">

  <!-- TOP BAR -->
  <div class="header-top">
    <div class="logo">SMART CART</div>

    <!-- SEARCH -->
    <div class="search-bar">
      <input type="text" placeholder="Search..." [(ngModel)]="searchTerm" (keyup.enter)="onSearch()">
      <button (click)="onSearch()"><i class="fas fa-search"></i></button>
    </div>

    <!-- ICONS -->
    <div class="header-icons">

      <!-- USER -->
      <!-- USER -->
      <div class="user-menu-wrapper" (mouseenter)="onMouseEnterUser()" (mouseleave)="onMouseLeaveUser()">
        <span class="user-icon" (click)="toggleUserMenu()" style="cursor: pointer;">
          <i class="far" [ngClass]="(isAuthenticated | async) ? 'fa-user-circle' : 'fa-user'"></i>
          <span *ngIf="isAuthenticated | async" class="user-greeting">
            Hi, {{ (currentUser | async)?.name || 'User' }}
          </span>
        </span>

        <!-- PROFILE DROPDOWN -->
        <div class="user-dropdown" *ngIf="userDropdown() && (isAuthenticated | async)">
          <div class="user-info">
            <p class="name">{{ (currentUser | async)?.fullName || 'My Account' }}</p>
            <p class="email">{{ (currentUser | async)?.emailAddress }}</p>
          </div>
          <hr>
          <ul>
            <li><a [routerLink]="['/user/index']"><i class="fas fa-th-large"></i> Personal Center</a></li>
            <li><a [routerLink]="['/user/index/profile']"><i class="fas fa-id-card"></i> My Profile</a></li>
            <li><a [routerLink]="['/user/index/orders']"><i class="fas fa-box"></i> My Orders</a></li>
            <li><a [routerLink]="['/user/index/coupons']"><i class="fas fa-ticket-alt"></i> My Coupons</a></li>
            <li><a [routerLink]="['/user/index/viewed']"><i class="fas fa-eye"></i> Recently Viewed</a></li>
            <hr style="border-top: 1px solid #f0f0f0; margin: 5px 0;">
            <li (click)="logout()"><a href="javascript:void(0)"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
          </ul>
        </div>
      </div>



      <!-- CART -->
      <!-- CART -->
      <div class="cart-wrapper" (mouseenter)="onMouseEnterCart()" (mouseleave)="onMouseLeaveCart()">
        <a href="javascript:void(0)" class="cart-icon-link" (click)="cartDropdown.set(!cartDropdown())">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-badge" id="iconCartQty" *ngIf="cartService.totalItems > 0">{{ cartService.totalItems
            }}</span>
        </a>

        <!-- HOVER CART MODAL -->
        <div id="hoverCartModal" class="hover-cart-modal" *ngIf="cartDropdown()">
          <div class="hover-cart-content">
            <span class="hover-close" (click)="closeModal()">&times;</span>

            <div class="top-line">
              <input type="checkbox" id="hoverMain" checked>
              <span class="black-text">Use coupon now to save</span>
              <span class="red-text">$10.00</span>
            </div>

            <!-- EMPTY STATE -->
            <div *ngIf="cartService.items().length === 0" style="padding: 20px; text-align: center;">
              <p>Shopping cart is Empty</p>
            </div>

            <!-- PRODUCT LIST GROUPED BY STORE (SCROLLABLE) -->
            <div class="product-card-scroll" *ngIf="cartService.items().length > 0">
              <!-- Loop through each store -->
              <div *ngFor="let storeName of getStores()">
                <!-- Store Header with Checkbox -->
                <div class="view-cart-header">
                  <input type="checkbox" [id]="'store-' + storeName"
                    [checked]="isStoreChecked(storeName) || isAnyStoreItemChecked(storeName)"
                    [indeterminate]="isAnyStoreItemChecked(storeName) && !isStoreChecked(storeName)"
                    (change)="onStoreCheckboxChange(storeName, $event)">
                  <span>{{ storeName }}</span>
                </div>

                <!-- Products for this store -->
                <div class="product-card show-hover" *ngFor="let item of getItemsByStore(storeName)">
                  <input type="checkbox" class="prod-check" [checked]="item.isChecked"
                    (change)="onItemCheckboxChange(item)">
                  <img [src]="item.image" [routerLink]="['/product-detail', item.productId, item.storeProductId]"
                    style="cursor: pointer;" />

                  <div class="prod-details">
                    <div class="prod-title" [routerLink]="['/product-detail', item.productId, item.storeProductId]"
                      style="cursor: pointer;">{{ item.name }}</div>
                    <div class="sold-by">Sold by {{ item.storeName }}</div>
                    <div class="color-qty">
                      <div class="sizes">{{ item.color }} / ({{ item.size }})</div>
                      <div class="qty-box-modal">
                        <span class="qty-label">Qty:</span>
                        <div class="qty-controls">
                          <button class="qty-btn-modal" (click)="decrementQty(item)">-</button>
                          <span class="qty-val">{{ item.quantity }}</span>
                          <button class="qty-btn-modal" (click)="incrementQty(item)">+</button>
                        </div>
                      </div>
                    </div>

                    <div class="price-del">
                      <div class="price">${{ item.price | number:'1.2-2' }}</div>
                      <div class="del-icon" (click)="removeItem(item)">ðŸ—‘</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="total-area">
              <div class="hover-all-checkbox-total-price">
                <div class="top-line-all">
                  <input type="checkbox" id="allCheck" [checked]="isAllChecked()"
                    (change)="onAllCheckboxChange($event)">
                  <span class="All-text">All</span>
                </div>
                Total: <span class="del" id="hoverTotalPrice">${{ cartService.totalPrice | number:'1.2-2' }}</span>
              </div>
            </div>

            <div class="view-cart">
              <a routerLink="/add-to-cart">VIEW CART (<span id="hoverCartQty">{{ cartService.totalItems }}</span>)</a>
            </div>
          </div>
        </div>
      </div>

      <!-- WISHLIST / MESSAGE -->
      <a href="#"><i class="far fa-heart"></i></a>
      <a href="#"><i class="far fa-comment-dots"></i></a>

      <!-- GLOBE -->
      <div class="currency-menu-wrapper">
        <a href="javascript:void(0)" (click)="globeDropdown.set(!globeDropdown())"><i class="fas fa-globe"></i></a>
        <div class="currency-tooltip-box" *ngIf="globeDropdown()">
          <div class="tooltip-section">
            <p class="section-title">Currency</p>
            <select>
              <option value="USD">$ USD</option>
              <option value="EUR">â‚¬ EUR</option>
              <option value="GBP">Â£ GBP</option>
              <option value="JPY">Â¥ JPY</option>
            </select>
          </div>
          <div class="tooltip-section">
            <p class="section-title">Language</p>
            <div class="language-options">
              <span class="active">English</span>
              <span>EspaÃ±ol</span>
            </div>
          </div>
          <a href="#" class="international-link">International Site</a>
        </div>
      </div>

    </div>
  </div>

  <!-- NAVBAR -->
  <div class="navbar-wrapper">
    <nav class="navbar" #navbar>
      <ul class="navbar-nav flex-row">
        <!-- Nav items -->
        <li class="nav-item"><a class="nav-link" href="#">Categories <i class="fa-solid fa-angle-down"></i></a></li>
        <li class="nav-item"><a class="nav-link active" href="#">New In</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Sale</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Women Clothing</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Kids</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Curve</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Men Clothing</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Shoes</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Underwear & Sleepwear</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Home & Kitchen</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Jewelry & Accessories</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Beauty & Health</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Baby & Maternity</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Bags & Luggage</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Sports & Outdoors</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Textiles</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Cell Phones & Accessories</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Electronics</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Toys & Games</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Tools & Home Improvement</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Office & School Supplies</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Pet Supplies</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Appliances</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Automotive</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Books & Magazine</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Food & Beverages</a></li>
        <!-- aur baki items -->
      </ul>

      <!-- Scroll Buttons inside nav wrapper -->
      <div class="scroll-btns">
        <button class="scroll-btn left" (click)="scrollLeft()">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <button class="scroll-btn right" (click)="scrollRight()">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </nav>
  </div>

</header>
<app-auth-modal *ngIf="authModalOpen()" (close)="authModalOpen.set(false)"></app-auth-modal>