<div class="add-product-container">
    <!-- Page Header -->
    <div class="page-header mb-5">
        <i class="fas fa-store"></i>
        <span>Add Product in Your Store Listing</span>
    </div>

    <!-- Floating Search Bar -->
    <div class="search-section mb-5" *ngIf="!product">
        <div class="search-wrapper d-flex align-items-center gap-3">
            <span class="fs-4">üîç</span>
            <input type="text" class="search-input" placeholder="Search by Product ID / Name / SKU"
                [(ngModel)]="searchQuery" (keyup.enter)="onSearch()">
            <button class="btn btn-primary rounded-3 px-4" (click)="onSearch()" [disabled]="isSearching">
                <i class="fas" [class.fa-search]="!isSearching" [class.fa-spinner]="isSearching"
                    [class.fa-spin]="isSearching"></i>
            </button>
        </div>
    </div>

    <!-- Search Results (Horizontal Cards) -->
    <div class="results-container mb-5" *ngIf="showResults && !product">
        <h5 class="fw-bold mb-4 text-muted">Search Results</h5>
        <div class="product-card d-flex align-items-center justify-content-between mb-4"
            *ngFor="let res of searchResults">
            <div class="d-flex align-items-center gap-4">
                <img [src]="res.images[0]" class="product-img" />
                <div>
                    <h5 class="mb-2 fw-semibold">{{res.name}}</h5>
                    <div class="badge-group">
                        <span class="badge-soft">ID: {{res.id.substring(0, 8)}}...</span>
                        <span class="badge-soft">Category: {{res.categoryName}}</span>
                        <span class="badge-soft">Brand: {{res.brandName || 'Generic'}}</span>
                    </div>
                    <span class="price-badge">${{res.supplierPrice}}</span>
                </div>
            </div>

            <div class="action-group">
                <button class="add-btn" (click)="selectProduct(res)">Add to Store</button>
            </div>
        </div>
    </div>

    <!-- Mapping Form (Appears when product is selected) -->
    <div class="mapping-section animate__animated animate__fadeInUp" *ngIf="product">
        <!-- Display Selected Product Core Info -->
        <div class="card-wrapper">
            <div class="product-mapping-info">
                <div class="gallery">
                    <div class="main-image">
                        <img [src]="selectedImage" alt="Product Image">
                    </div>
                    <div class="thumbs">
                        <div class="thumb" *ngFor="let img of product.images" [class.active]="selectedImage === img"
                            (click)="selectImage(img)">
                            <img [src]="img">
                        </div>
                    </div>
                </div>

                <div class="product-content">
                    <div class="product-title">{{product.name}}</div>
                    <div class="info-row">
                        <div class="pill"><i class="fas fa-hashtag"></i> ID: {{product.id.substring(0, 8)}}...</div>
                        <div class="pill"><i class="fas fa-tag"></i> Category: {{product.categoryName}}</div>
                        <div class="pill"><i class="fas fa-copyright"></i> Brand: {{product.brandName || 'Generic'}}
                        </div>
                    </div>
                    <div class="price"><i class="fas fa-tag"></i> Supplier Price: ${{product.supplierPrice}}</div>
                </div>
            </div>
        </div>

        <!-- Attribute Setting Card -->
        <div class="attribute-card">
            <div class="attribute-header mb-4">
                <h4 class="fw-bold border-bottom pb-2 display-inline-block"
                    style="border-width: 2px !important; border-color: #0f172a !important; display: inline-block;">Set
                    Attributes For Store Listing</h4>
            </div>

            <div class="form-grid">
                <!-- Maximum Price (Read-only Guide) -->
                <div class="form-group">
                    <label class="fw-bold mb-2">Maximum Price</label>
                    <div class="input-box custom-input-wrapper bg-light border-0">
                        <span class="input-prefix fw-bold">$</span>
                        <input type="number" [value]="maxAllowedPrice" readonly placeholder="0.00">
                    </div>
                </div>

                <!-- Standard Price (User Input) -->
                <div class="form-group">
                    <label class="fw-bold mb-2">Standard Price</label>
                    <div class="input-box custom-input-wrapper" [class.border-danger]="retailPrice > maxAllowedPrice">
                        <span class="input-prefix fw-bold">$</span>
                        <input type="number" [(ngModel)]="retailPrice" [disabled]="isViewOnly" placeholder="0.00">
                    </div>
                    <!-- Validation Message -->
                    <div *ngIf="retailPrice > maxAllowedPrice" class="text-danger small mt-1">
                        <i class="fas fa-exclamation-triangle"></i> Price exceeds the maximum allowed limit of
                        ${{maxAllowedPrice}}
                    </div>
                </div>

                <!-- Handling Time -->
                <div class="form-group">
                    <label class="fw-bold mb-2">Handling Time</label>
                    <div class="input-box custom-input-wrapper">
                        <span class="input-prefix text-muted fw-bold">Days</span>
                        <input type="number" [(ngModel)]="handlingTime" min="1" max="30" [disabled]="isViewOnly">
                    </div>
                </div>

                <!-- Max Order Quantity -->
                <div class="form-group">
                    <label class="fw-bold mb-2">Max Order Quantity</label>
                    <div class="input-box custom-input-wrapper">
                        <span class="input-prefix text-muted fw-bold">Units</span>
                        <input type="number" [(ngModel)]="maxOrderQty" min="1" max="100" [disabled]="isViewOnly">
                    </div>
                </div>

            </div>

            <div class="actions mt-4">
                <button class="btn btn-cancel" (click)="cancelSearch()">
                    <i class="fas fa-times"></i> {{ isViewOnly ? 'Back to Listings' : 'Cancel' }}
                </button>
                <button class="btn btn-primary px-4" (click)="publishToStore()" *ngIf="!isViewOnly">
                    <i class="fas fa-check-circle"></i> Publish to Store
                </button>
            </div>
        </div>
    </div>
</div>