<app-order-process-header [showLocation]="false">
</app-order-process-header>

<div class="checkout-wrapper">
  <div class="top-bar" *ngIf="showTopBar">
    <div class="content">
      <span class="item"><i class="check">✔</i> Free shipping</span>
      <span class="dot">·</span>
      <span class="item">Free Return</span>
      <span class="dot">·</span>
      <span class="item">500 Points if Late</span>
      <span class="dot">·</span>
      <span class="item">No Hidden Fees</span>
    </div>
  </div>

  <!-- Multi-Step Stepper -->
  <app-order-process-breadcrumb [activeStep]="checkoutStep" (stepClick)="handleStepClick($event)">
  </app-order-process-breadcrumb>

  <div class="checkout-layout container">
    <div class="row">
      <div class="col-lg-8">

        <!-- STEP 1: SHIPPING -->
        <div class="step-container animate-fade-in" *ngIf="checkoutStep === 1">
          <app-shipping-address (addressSaved)="handleAddressSaved()"></app-shipping-address>

          <div class="step-actions mt-4">
            <button class="btn btn-next" (click)="nextStep()">
              Continue to Payment <i class="pi pi-arrow-right ms-2"></i>
            </button>
          </div>
        </div>

        <!-- STEP 2: PAYMENT -->
        <div class="step-container animate-fade-in" *ngIf="checkoutStep === 2">
          <div class="address-summary-card mb-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h5 class="mb-1">Shipping to:</h5>
                <p class="mb-0 text-muted">{{ savedAddressData?.firstName }} {{ savedAddressData?.lastName }} - {{
                  savedAddressData?.address1 }}, {{ savedAddressData?.city }}</p>
              </div>
              <button class="btn btn-link text-primary p-0" (click)="checkoutStep = 1">Change</button>
            </div>
          </div>

          <app-payment-method (paymentConfirmed)="handlePaymentConfirmed($event)"></app-payment-method>

          <div class="step-actions mt-4">
            <button class="btn btn-outline-secondary" (click)="checkoutStep = 1">
              <i class="pi pi-arrow-left me-2"></i> Back to Shipping
            </button>
          </div>
        </div>

      </div>

      <!-- Right Side: Order Summary (Always Visible) -->
      <div class="col-lg-4">
        <app-checkout-summary [showPlaceOrder]="false" [disablePlaceOrder]="true" (placeOrder)="handlePlaceOrder()">
        </app-checkout-summary>

        <div class="cart-items-preview mt-3">
          <app-checkout-product></app-checkout-product>
        </div>
      </div>
    </div>
  </div>
</div>